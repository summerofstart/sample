<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="JSON、XML、YAMLのフォーマット変換ツール">
    <title>フォーマット変換ツール</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&display=swap" rel="stylesheet">
    <!-- AdSenseのスクリプトをここに配置 -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-XXXXXXXXXXXXXX"
     crossorigin="anonymous"></script>
    <style>
        /* 前回のCSSをここに配置 */
        /* 追加のスタイル */
        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }

        .loading::after {
            content: '';
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid #f3f3f3;
            border-top: 2px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .sample-button {
            font-size: 12px;
            padding: 4px 8px;
            margin-left: 8px;
            background: #f3f4f6;
            border: 1px solid #e5e7eb;
            border-radius: 4px;
            cursor: pointer;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 8px;
            background: #4caf50;
            color: white;
            display: none;
            animation: slideIn 0.3s ease-out;
            z-index: 1000;
        }

        @keyframes slideIn {
            from { transform: translateX(100%); }
            to { transform: translateX(0); }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="main-content">
            <!-- 上部広告 -->
            <ins class="adsbygoogle"
                 style="display:block"
                 data-ad-client="ca-pub-XXXXXXXXXXXXXX"
                 data-ad-slot="XXXXXXXXXX"
                 data-ad-format="auto"
                 data-full-width-responsive="true"></ins>

            <div class="card">
                <h1 class="title">フォーマット変換ツール</h1>
                
                <div>
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <label class="label">JSONを入力:</label>
                        <button class="sample-button" id="sampleData">サンプルデータを挿入</button>
                    </div>
                    <textarea id="input" class="textarea" placeholder='{"example": "value"}'></textarea>
                </div>

                <div class="button-group">
                    <button class="button active" data-format="json">JSON</button>
                    <button class="button" data-format="xml">XML</button>
                    <button class="button" data-format="yaml">YAML</button>
                </div>

                <div class="button-group">
                    <button class="button primary" id="convert">変換</button>
                </div>

                <div id="loading" class="loading"></div>
                <div id="error" class="error"></div>

                <div id="output-container" style="display: none;">
                    <div class="controls">
                        <label class="label">結果:</label>
                        <div>
                            <button class="button" id="copy">コピー</button>
                            <button class="button" id="reset">リセット</button>
                            <button class="button" id="download">ダウンロード</button>
                        </div>
                    </div>
                    <textarea id="output" class="textarea" readonly></textarea>
                </div>
            </div>

            <!-- 下部広告 -->
            <ins class="adsbygoogle"
                 style="display:block"
                 data-ad-client="ca-pub-XXXXXXXXXXXXXX"
                 data-ad-slot="XXXXXXXXXX"
                 data-ad-format="auto"
                 data-full-width-responsive="true"></ins>
        </div>

        <!-- サイドバー -->
        <div class="sidebar">
            <ins class="adsbygoogle"
                 style="display:block"
                 data-ad-client="ca-pub-XXXXXXXXXXXXXX"
                 data-ad-slot="XXXXXXXXXX"
                 data-ad-format="vertical"
                 data-full-width-responsive="false"></ins>
        </div>
    </div>

    <div id="notification" class="notification"></div>

    <footer class="footer">
        <p>© 2024 フォーマット変換ツール - すべての権利を保有</p>
    </footer>

    <script>
        // 要素の取得
        const input = document.getElementById('input');
        const output = document.getElementById('output');
        const errorDiv = document.getElementById('error');
        const loading = document.getElementById('loading');
        const outputContainer = document.getElementById('output-container');
        const notification = document.getElementById('notification');
        let currentFormat = 'json';

        // サンプルデータ
        const sampleData = {
            "person": {
                "name": "山田太郎",
                "age": 30,
                "address": {
                    "city": "東京",
                    "country": "日本"
                },
                "hobbies": ["読書", "旅行", "プログラミング"]
            }
        };

        // 通知を表示する関数
        function showNotification(message, duration = 3000) {
            notification.textContent = message;
            notification.style.display = 'block';
            setTimeout(() => {
                notification.style.display = 'none';
            }, duration);
        }

        // サンプルデータを挿入
        document.getElementById('sampleData').addEventListener('click', () => {
            input.value = JSON.stringify(sampleData, null, 2);
        });

        // フォーマットボタンの処理
        document.querySelectorAll('[data-format]').forEach(button => {
            button.addEventListener('click', () => {
                document.querySelectorAll('[data-format]').forEach(btn => {
                    btn.classList.remove('active');
                });
                button.classList.add('active');
                currentFormat = button.dataset.format;
            });
        });

        // XMLフォーマット関数
        function formatXML(obj, level = 0) {
            const indent = '  '.repeat(level);
            let xml = '';
            for (const key in obj) {
                const value = obj[key];
                if (Array.isArray(value)) {
                    value.forEach(item => {
                        xml += `${indent}<${key}>${typeof item === 'object' ? 
                            '\n' + formatXML(item, level + 1) + indent : item}</${key}>\n`;
                    });
                } else if (typeof value === 'object' && value !== null) {
                    xml += `${indent}<${key}>\n${formatXML(value, level + 1)}${indent}</${key}>\n`;
                } else {
                    xml += `${indent}<${key}>${value}</${key}>\n`;
                }
            }
            return xml;
        }

        // YAMLフォーマット関数
        function formatYAML(obj, level = 0) {
            const indent = '  '.repeat(level);
            let yaml = '';
            for (const key in obj) {
                const value = obj[key];
                if (Array.isArray(value)) {
                    yaml += `${indent}${key}:\n`;
                    value.forEach(item => {
                        yaml += `${indent}- ${typeof item === 'object' ? 
                            '\n' + formatYAML(item, level + 2) : item}\n`;
                    });
                } else if (typeof value === 'object' && value !== null) {
                    yaml += `${indent}${key}:\n${formatYAML(value, level + 1)}`;
                } else {
                    yaml += `${indent}${key}: ${value}\n`;
                }
            }
            return yaml;
        }

        // 変換処理
        document.getElementById('convert').addEventListener('click', async () => {
            errorDiv.style.display = 'none';
            loading.style.display = 'block';
            outputContainer.style.display = 'none';

            try {
                // 入力値のバリデーション
                if (!input.value.trim()) {
                    throw new Error('JSONを入力してください');
                }

                const parsedInput = JSON.parse(input.value);
                let result = '';

                // 非同期処理をシミュレート
                await new Promise(resolve => setTimeout(resolve, 500));

                switch (currentFormat) {
                    case 'json':
                        result = JSON.stringify(parsedInput, null, 2);
                        break;
                    case 'xml':
                        result = `<?xml version="1.0" encoding="UTF-8"?>\n<root>\n${formatXML(parsedInput, 1)}</root>`;
                        break;
                    case 'yaml':
                        result = formatYAML(parsedInput);
                        break;
                }

                output.value = result;
                outputContainer.style.display = 'block';
            } catch (err) {
                errorDiv.textContent = err.message === 'JSONを入力してください' ? 
                    err.message : 'JSONの形式が正しくありません';
                errorDiv.style.display = 'block';
            } finally {
                loading.style.display = 'none';
            }
        });

        // コピー処理
        document.getElementById('copy').addEventListener('click', async () => {
            try {
                await navigator.clipboard.writeText(output.value);
                showNotification('コピーしました！');
            } catch (err) {
                showNotification('コピーに失敗しました', 'error');
            }
        });

        // ダウンロード処理
        document.getElementById('download').addEventListener('click', () => {
            const blob = new Blob([output.value], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `converted.${currentFormat}`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            showNotification('ダウンロードを開始しました');
        });

        // リセット処理
        document.getElementById('reset').addEventListener('click', () => {
            input.value = '';
            output.value = '';
            errorDiv.style.display = 'none';
            outputContainer.style.display = 'none';
            showNotification('リセットしました');
        });

        // AdSenseの初期化
        (adsbygoogle = window.adsbygoogle || []).push({});
    </script>
</body>
</html>
